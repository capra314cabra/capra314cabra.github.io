---
title: "Create a button whose background is filled by images on Avalonia UI"
date: 2020-03-31T11:34:47+09:00
description: "I will describe how to create a button whose background is filled by images on a crossplatform GUI library, Avalonia UI."
keyword: "Avalonia,button,image,picture,C#"
author: "capra314cabra"
tags: ["CSharp", "Avalonia", "WPF"]
draft: false
---

On this article, I will describe how to create a button whose background is filled by images on a crossplatform GUI library, Avalonia UI.

<img src="https://capra314cabra.github.io/images/2020-03-29/ButtonClick2.gif" alt="On button clicked (Successed)" class="center" width="438" height="211" />

I had a harder time to make it than I had expected. I beleive that this saves your time.

## Precondition

- You have an Avalonia project already.
- You have finished to choose images to use already.

I recommend you to prepare three images, normal, hovering, clicking.  
Indeed, you can do it with just one image.

## 1. Put images into Assets folder

First, put all images into `Assets` folder, which should be generated by Avalonia. It's because we can touch them easier on the code.  
If the `Assets` folder doesn't exist, you should create one and append a XML content to your project file:

``` xml
<ItemGroup>
  <AvaloniaResource Include="Assets\*"/>
</ItemGroup>
```

## 2. Create a UserControl

Here is a quote from the tutorial of Avalonia.  
You can change the name of it whatever you want.

> [Visual Studio]
>
> 1. Right click your project's Views folder in Solution Explorer
> 2. Select the Add -> New Item menu item
> 3. In the dialog that appears, navigate to the "Avalonia" section in the category tree
> 4. Select "User Control (Avalonia)"
> 5. Enter TodoListView as the "Name"
> 6. Click the "Add" button
>
> [.NET Core]
>
> ```dotnet new avalonia.usercontrol -o Views -n TodoListView  --namespace Todo.Views```

[Quote from Avalonia Tutorial](https://avaloniaui.net/docs/tutorial/creating-a-view)

After that, you will get a XAML file, whose contents should be like that:

``` xml
<UserControl xmlns="https://github.com/avaloniaui"
    	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    	mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
    	x:Class="Hoge.Views.ImageButton">
    <StackPanel>
        Hello World
    </StackPanel>
</UserControl>
```
It's just a UserControl so it is never shown without editing kinds of MainWindow. If you don't know how to let it shown, ~~you can google it~~.  
Replacing the text, "Hello World" with your specific UI, it would be shown.

## Create a button

I think you can easily understand this section if you have any experiences in writing HTML+CSS. They looks like each other. I can describe about the things for long time, but it makes nothing. Seeing is believing.

``` xml
<UserControl xmlns="https://github.com/avaloniaui"
    	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    	mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
    	x:Class="AvaloniaTest.Views.MainContents">
    <StackPanel>
        <StackPanel.Styles>
            <Style Selector="Button.ImageButton">
                <!-- Write styles here -->
            </Style>
        </StackPanel.Styles>
        <Button Classes="ImageButton">Click me</Button>
    </StackPanel>
</UserControl>
```

This is a code, which shows a normal button. We will customize and shape it to what we want.

## Use images as a background of the button

To achieve to create a button we expected, we use `ImageBrush`, which can draw a image, to the background of the button.

``` xml
<UserControl xmlns="https://github.com/avaloniaui"
    	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    	mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
    	x:Class="AvaloniaTest.Views.MainContents">
    <StackPanel>
        <StackPanel.Styles>
            <Style Selector="Button.ImageButton">
                <!-- Please change it as you like -->
                <Setter Property="FontSize" Value="30" />
                <Setter Property="Width" Value="400" />
                <Setter Property="Height" Value="100" />

                <!-- Set a background -->
                <Setter Property="Background">
					<Setter.Value>
                        <!-- avares://[Project name]/Assets/[File name] -->
						<ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar.png" />
					</Setter.Value>
				</Setter>
            </Style>
        </StackPanel.Styles>
        <Button Classes="ImageButton">Click me</Button>
    </StackPanel>
</UserControl>
```

<img src="https://capra314cabra.github.io/images/2020-03-29/ButtonClick1.gif" alt="On button clicked (failed)" class="center" width="462" height="162" />

There is a border which is not needed. Setting the value `BorderThickness` as zero have it deleted.

``` xml
<Setter Property="BorderThickness" Value="0" />
```

## Style changes while user pointer hovering

``` xml
<!-- On user pointer hovering -->
<Style Selector="Button.ImageButton:pointerover">
	<Setter Property="Background">
		<Setter.Value>
            <!-- avares://[Project name]/Assets/[File name] -->
			<ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar_Hover.png" />
		</Setter.Value>
	</Setter>
</Style>
```

Like CSS, you can implement the style changes corresponding user actions by selector, which formatted as `[Class name]:[Action]`.
Note that it is `pointerover`, not `hover`.  
After it applies, the button would be:

<img src="https://capra314cabra.github.io/images/2020-03-29/ButtonHover.gif" alt="On button clicked (failed)" class="center" width="462" height="162" />

## Style changes while user clicking

This is the most important point of this article.  
You may think it just write `Button.ImageButton:pressed` and work well. I did think too, but things don't work that well in the real world...

``` xml
<!-- On user clicking -->
<Style Selector="Button.ImageButton:pressed /template/ ContentPresenter">
    <Setter Property="Background">
        <Setter.Value>
            <!-- avares://[Project name]/Assets/[File name] -->
            <ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar_Click.png" />
        </Setter.Value>
    </Setter>
</Style>
```

Write `Button.ImageButton:pressed /template/ ContentPresenter` or it would __NOT__ work well. All we have to do is to remember this. It's not difficult, isn't it?

After all, we make it.

<img src="https://capra314cabra.github.io/images/2020-03-29/ButtonClick2.gif" alt="On button clicked (Successed)" class="center" width="438" height="211" />

If you know better ways, please let me know.

## Full code

``` xml
<UserControl xmlns="https://github.com/avaloniaui"
    	xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    	xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    	xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    	mc:Ignorable="d" d:DesignWidth="800" d:DesignHeight="450"
    	x:Class="AvaloniaTest.Views.MainContents">
    <StackPanel>
        <StackPanel.Styles>
            <Style Selector="Button.ImageButton">
                <!-- Please change it as you like -->
                <Setter Property="FontSize" Value="30" />
                <Setter Property="Width" Value="400" />
                <Setter Property="Height" Value="100" />
                <Setter Property="BorderThickness" Value="0" />

                <!-- Set a background -->
                <Setter Property="Background">
					<Setter.Value>
                        <!-- avares://[Project name]/Assets/[File name] -->
						<ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar.png" />
					</Setter.Value>
				</Setter>
            </Style>
            <!-- On user pointer hovering -->
            <Style Selector="Button.ImageButton:pointerover">
                <!-- Set a background -->
                <Setter Property="Background">
                    <Setter.Value>
                        <!-- avares://[Project name]/Assets/[File name] -->
                        <ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar_Hover.png" />
                    </Setter.Value>
                </Setter>
            </Style>
            <!-- On user clicking -->
            <Style Selector="Button.ImageButton:pressed /template/ ContentPresenter">
                <!-- Set a background -->
                <Setter Property="Background">
                    <Setter.Value>
                        <!-- avares://[Project name]/Assets/[File name] -->
                        <ImageBrush Source="avares://AvaloniaTest/Assets/ButtonBar_Click.png" />
                    </Setter.Value>
                </Setter>
            </Style>
        </StackPanel.Styles>
        <Button Classes="ImageButton">Click me</Button>
    </StackPanel>
</UserControl>
```